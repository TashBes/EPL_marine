<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="First Author">
<meta name="dcterms.date" content="2025-06-08">

<title>Add the title of your page here</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="scientific_files/libs/clipboard/clipboard.min.js"></script>
<script src="scientific_files/libs/quarto-html/quarto.js"></script>
<script src="scientific_files/libs/quarto-html/popper.min.js"></script>
<script src="scientific_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="scientific_files/libs/quarto-html/anchor.min.js"></script>
<link href="scientific_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="scientific_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="scientific_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="scientific_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="scientific_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<style>

      .quarto-title-block .quarto-title-banner h1,
      .quarto-title-block .quarto-title-banner h2,
      .quarto-title-block .quarto-title-banner h3,
      .quarto-title-block .quarto-title-banner h4,
      .quarto-title-block .quarto-title-banner h5,
      .quarto-title-block .quarto-title-banner h6
      {
        color: white;
      }

      .quarto-title-block .quarto-title-banner {
        color: white;
background: #A7A9AC;
      }
</style>


<meta name="citation_title" content="Add the title of your page here">
<meta name="citation_author" content="First Author">
<meta name="citation_publication_date" content="2025-06-08">
<meta name="citation_cover_date" content="2025-06-08">
<meta name="citation_year" content="2025">
<meta name="citation_online_date" content="2025-06-08">
<meta name="citation_fulltext_html_url" content="http://nba.sanbi.org.za/">
<meta name="citation_language" content="en">
<meta name="citation_journal_title" content="National Biodiversity Assessment 2025">
<meta name="citation_publisher" content="South African National Biodiversity Institute">
<meta name="citation_reference" content="citation_title=Advancing land-sea integration for ecologically meaningful coastal conservation and management;,citation_author=Linda R. Harris;,citation_author=Mariel Bessinger;,citation_author=Anisha Dayaram;,citation_author=Stephen Holness;,citation_author=Stephen Kirkman;,citation_author=Tamsyn-Claire Livingstone;,citation_author=Amanda T. Lombard;,citation_author=Melanie Lück-Vogel;,citation_author=Maya Pfaff;,citation_author=Kerry J. Sink;,citation_author=Andrew L. Skowno;,citation_author=Lara Van Niekerk;,citation_publication_date=2019-09;,citation_cover_date=2019-09;,citation_year=2019;,citation_fulltext_html_url=http://dx.doi.org/10.1016/j.biocon.2019.06.020;,citation_doi=10.1016/j.biocon.2019.06.020;,citation_volume=237;,citation_language=en;,citation_journal_title=Biological Conservation;">
<meta name="citation_reference" content="citation_title=Megadiversity: Earth’s biologically wealthiest nations;,citation_author=R. A. Mittermeier;,citation_author=P. Robles-Gil;,citation_author=C. G. Mittermeier;,citation_publication_date=1997;,citation_cover_date=1997;,citation_year=1997;">
<meta name="citation_reference" content="citation_title=Indicators;,citation_author=J. R. Wilson;,citation_author=B. W. Van Wilgen;,citation_author=K. Faulkner;,citation_author=D. Richardson;,citation_author=S. Rahlao;,citation_author=T. Zengeya;,citation_editor=B. W. Van Wilgen;,citation_editor=J. R. Wilson;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_inbook_title=The status of biological invasions and their management in south africa in 2017;">
<meta name="citation_reference" content="citation_title=National terrestrial carbon sinks assessment: Technical report;,citation_author=Graham Von Maltitz;,citation_author=Bob Scholes;,citation_author=Marc Pienaar;,citation_author=Claire Davis-Reddy;,citation_author=Tony Knowles;,citation_author=Liesl Wiese;,citation_publication_date=2020;,citation_cover_date=2020;,citation_year=2020;,citation_fulltext_html_url=https://csa.environment.gov.za/technical-reports#h.atp56x6v335w;,citation_technical_report_institution=Department of Environment, Forestry and Fisheries;">
<meta name="citation_reference" content="citation_title=Chapter 3: Direct and indirect drivers of land degradation and restoration;,citation_author=N. N. Barger;,citation_author=T. A. Gardner;,citation_author=M. Sankaran;,citation_author=J. Belnap;,citation_author=L. Broadhurst;,citation_author=V. Brochier;,citation_author=F. Isbell;,citation_author=P. Meyfroidt;,citation_author=F. Moreira;,citation_author=T. M. Nieminen;,citation_author=T. Okuro;,citation_author=R. R. Rodrgiues;,citation_author=V. Saxena;,citation_author=M. C. Ross;,citation_editor=L. Montanarella;,citation_editor=R. Scholes;,citation_editor=A. Brainich;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_inbook_title=The IPBES assessment report on land degradation and restoration;">
<meta name="citation_reference" content="citation_title=South african national biodiversity assessment 2018 technical report volume 1: Terrestrial realm;,citation_editor=A. L. Skowno;,citation_editor=D. C. Raimondo;,citation_editor=C. J. Poole;,citation_editor=B. Fizzotti;,citation_editor=J. A. Slingsby;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;">
<meta name="citation_reference" content="citation_title=Investigating the direct and indirect drivers of land use and land cover change from agriculture to acacia plantations in banja district, awi zone, ethiopia;,citation_author=Engidayehu Melaku;,citation_author=Asabeneh Alemayehu;,citation_author=Kassa Chanie;,citation_publication_date=2024-06-08;,citation_cover_date=2024-06-08;,citation_year=2024;,citation_fulltext_html_url=http://dx.doi.org/10.37284/eajab.7.1.1973;,citation_issue=1;,citation_doi=10.37284/eajab.7.1.1973;,citation_volume=7;,citation_journal_title=East African Journal of Agriculture and Biotechnology;">
<meta name="citation_reference" content="citation_title=Butterflies and Moths database home page;,citation_author=The Natural History Museum;,citation_publication_date=2019;,citation_cover_date=2019;,citation_year=2019;,citation_fulltext_html_url=http://www.nhm.ac.uk/our-science/data/butmoth;">
<meta name="citation_reference" content="citation_title=Biomes and bioregions of Southern Africa;,citation_author=M. C. Rutherford;,citation_author=L. Mucina;,citation_author=L. W Powrie;,citation_editor=L. Mucina;,citation_editor=M. C. Rutherford;,citation_publication_date=2006;,citation_cover_date=2006;,citation_year=2006;,citation_conference_title=The vegetation of South Africa, Lesotho and Swaziland;,citation_conference=South African National Biodiversity Institute;,citation_series_title=Strelitzia 19;">
</head>

<body>

<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Add the title of your page here</h1>
            <p class="subtitle lead">Add subtitle here</p>
                      </div>
  </div>
    
    <div class="quarto-title-meta-contents">
      <p class="author">
        First Author<sup>1</sup> <a href="https://orcid.org/0000-0000-0000-0000" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
      </p>
    </div>
    
   <div class="quarto-title-meta-contents-affiliation">
          <p class="affiliation">
        1. 
        
        Name of Affiliation
        
      </p>
        </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">June 8, 2025</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#approach" id="toc-approach" class="nav-link active" data-scroll-target="#approach">Approach</a></li>
  <li><a href="#data-sources-import" id="toc-data-sources-import" class="nav-link" data-scroll-target="#data-sources-import">Data sources &amp; import:</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data preparation:</a></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis">Analysis:</a>
  <ul>
  <li><a href="#ecosystem-protection-level-analysis" id="toc-ecosystem-protection-level-analysis" class="nav-link" data-scroll-target="#ecosystem-protection-level-analysis">Ecosystem Protection Level Analysis</a></li>
  <li><a href="#calculate-epl-benthic" id="toc-calculate-epl-benthic" class="nav-link" data-scroll-target="#calculate-epl-benthic">Calculate EPL Benthic</a></li>
  <li><a href="#summarise-ecosystem-protection-levels-for-2025-per-biome-calculate-epl-index" id="toc-summarise-ecosystem-protection-levels-for-2025-per-biome-calculate-epl-index" class="nav-link" data-scroll-target="#summarise-ecosystem-protection-levels-for-2025-per-biome-calculate-epl-index"><strong>Summarise Ecosystem Protection Levels for 2025 per Biome &amp; calculate EPL Index</strong></a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">





<hr>
<!--# Key statistics section: This section can be edited to report more/fewer statistics by adding more items to each column (these will be stacked), or adding more columns (then they will be placed next to each other). Using source view, copy and paste the entire block (the three lines with the pipe | at the start), and edit contents as necessary. Be careful to apply the correct styling parameters (the bits in the sqiggly brackets {}). If you are adding or removing columns, remember to adjust the column widths to add up to 100%. Preferably add more rows, as more than two columns tend to display poorly on narrow screens. Delete the entire section (plus the horizontal line above the Summary header) if you don't want to include statistics on your page-->
<div class="columns">
<div class="column" style="width:50%;">
<center>
<div class="line-block"><span class="inline-style-threatened">00%</span><br>
of 220 ecosystem types<br>
<span class="inline-style-indicator">Threatened</span></div>
<div class="line-block"><span class="inline-style-well-protected">00%</span><br>
of 220 ecosystem types<br>
<span class="inline-style-indicator">Well Protected</span></div>
</center>
</div><div class="column" style="width:50%;">
<center>
<div class="line-block"><span class="inline-style-not-protected">00%</span><br>
of 220 ecosystem types<br>
<span class="inline-style-indicator">Not protected</span></div>
<div class="line-block"><span class="inline-style-threatened">00%</span><br>
of 50 taxa assessed<br>
<span class="inline-style-indicator">Threatened</span></div>
</center>
</div>
</div>
<hr>
<section id="approach" class="level3">
<h3 class="anchored" data-anchor-id="approach">Approach</h3>
<p>Marine Ecosystem Protection Level assessment with the inclusion of additional steps to utilise condition of ecosystems within protected areas. This assessment is for 2025 and compares results from the new method to those from the 2018 assessment. It reveals the degree to which Protected Area targets have been met for each terrestrial ecosystem type (ecosystem representation). The analysis includes steps to address the effectiveness of MPAs by down weighting the contribution to targets for areas based on their degradation.</p>
</section>
<section id="data-sources-import" class="level3">
<h3 class="anchored" data-anchor-id="data-sources-import">Data sources &amp; import:</h3>
<p>The 4 class South African National condition map for 2018 (benthic) and 2011 (pelagic) (prepared by SANBI based on marine cumulative pressure mapping) was used to calculate the degradation scores for each ecosystem inside the MPA’s.</p>
<p>This 4 class condition was cross tabulated with the National Marine Ecosystem Map 2023 version, vector feature geodatabase (ESRI file geodatabase) (released …) curated by SANBI (cite) and the Protected Areas vector feature geodatabase prepared by SANBI.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `condition_mpa_2023' from data source 
  `C:\Users\N.Besseling\OneDrive - sanbi.org.za\SANBI Marine Programme - marine_data - marine_data\field_data\uncurated\condition_mpa_2023.csv' 
  using driver `CSV'</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `SANBI_PA_2023Q4_July2024' from data source 
  `C:\Users\N.Besseling\OneDrive - sanbi.org.za\SANBI Marine Programme - marine_data - marine_data\spatial_layers\protected_areas\SANBI_PA_2023Q4_July2024.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 18591 features and 20 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -944058.5 ymin: -5435839 xmax: 1525417 ymax: -2362554
Projected CRS: SA Albers Equal Area</code></pre>
</div>
</div>
</section>
<section id="data-preparation" class="level3">
<h3 class="anchored" data-anchor-id="data-preparation">Data preparation:</h3>
<p>Subset PA data to only include Marine Protected Areas using TYPE = “Marine Protected Area” and transform the CRS to match the ecosystem map. For both the ecosystem map and MPA layer combine the polygons of each ecosystem and protected area together into multipolygons to simplyfy the data.</p>
</section>
<section id="analysis" class="level3">
<h3 class="anchored" data-anchor-id="analysis">Analysis:</h3>
<p><em>Get the area of each ecosystem within an MPA.</em></p>
<p>Get the intersection of the MPA’s and the ecosystems, and then calculate the proportion of each ecosystem that falls within an MPA.</p>
<section id="ecosystem-protection-level-analysis" class="level4">
<h4 class="anchored" data-anchor-id="ecosystem-protection-level-analysis">Ecosystem Protection Level Analysis</h4>
<p>Marine Ecosystem Protection Level was calculated by assessing the degree to which protected areas targets for each ecosystem were met. By cross tabulating Marine ecosystem maps and protected areas maps for the marine realm we calculated for each ecosystem type (150 benthic and 13 pelagic types of marine ecosystems described for South Africa): i) the full extent of the type (<strong>a</strong>), ii) the percentage of the type within the MPA network (<strong>b</strong>), iii) the percentage of natural ecosystem remaining within the MPA network (<strong>c</strong>), iv) the percentage of moderately, severely, and very severely degraded ecosystem within the MPA network for each type (<strong>d</strong>). The target for each ecosysetm is 30% within an MPA.</p>
<p><strong><em>ecosystem type targets are 30% to align with GBF target]</em></strong></p>
<p>For each type:</p>
<p>The percentage of the type within the MPA network (<strong>b</strong>) was <strong>adjusted downwards</strong> (<strong>f</strong>) by subtracting 50% of the moderately degraded extent (<strong>d</strong>), 70% of the severely degraded extent (<strong>s</strong>) and 90% of the very severely degraded extent (<strong>vs</strong>) within the MPA network. This step ensures that effectiveness of MPA network is accounted for to a degree by preventing areas heavily degraded from fully contributing to ecosystem representation targets.</p>
<p>Then any ecosystem that reaches the 30% target after the condition adjustments has to contain at least 30% of natural extent within the MPA, otherwise it is adjusted downward to Moderately Protected.</p>
<p><strong><em>(c + d + s + vs)</em> b = f</strong>*</p>
<p>EPL classes:</p>
<ul>
<li><p>Well Protected (WP); target met or exceeded; <strong><em>f &gt;= 30% and c &gt;= 30% </em></strong></p></li>
<li><p>Moderately Protected (MP); ?% of target met (20-30% protected); <strong><em>30% =&gt; f&gt;= 20% </em></strong></p></li>
<li><p>Poorly Protected (PP); ?% of target met (0.2-20% protected); <strong><em>20% =&gt; f&gt;= 0.2%</em></strong></p></li>
<li><p>Not Protected (NP); less than ?% of target met (less than 0.2% protected); *<strong>f&lt;0.02*</strong></p></li>
</ul>
</section>
<section id="calculate-epl-benthic" class="level4">
<h4 class="anchored" data-anchor-id="calculate-epl-benthic">Calculate EPL Benthic</h4>
</section>
<section id="summarise-ecosystem-protection-levels-for-2025-per-biome-calculate-epl-index" class="level4">
<h4 class="anchored" data-anchor-id="summarise-ecosystem-protection-levels-for-2025-per-biome-calculate-epl-index"><strong>Summarise Ecosystem Protection Levels for 2025 per Biome &amp; calculate EPL Index</strong></h4>
<p>EPL Index calculation (Harris et al in prep)</p>
<p>(sum of WP *3 + sum of MP *2 + sum of PP *1 + sum NP *0 ) / sum all type *3</p>
<p><em>Calculate biome level summary of EPL 2024 and calculate EPLI 2024</em></p>
<!-- ```{r} -->
<!-- #summarise EPL 2024 per biome with adjustments for invasives  -->
<!-- epl2024inv_sum <- epl2024 %>% -->
<!--   group_by(T_BIOME,epl_nat_inv24) %>% -->
<!--   summarise(count = n(),.groups = 'drop') %>% -->
<!--   pivot_wider(names_from = epl_nat_inv24,  -->
<!--               values_from = count, values_fill = 0) %>% -->
<!--   relocate(WP, .before = MP)%>% -->
<!--   relocate(NP, .after = PP) %>% -->
<!--   # Add row-wise TOTAL -->
<!--   rowwise() %>% -->
<!--   mutate(Total = sum(c_across(where(is.numeric)))) %>% -->
<!--   ungroup() %>% -->
<!--   # Add TOTAL row (column-wise sums) -->
<!--   bind_rows(summarise(., T_BIOME = "Total", across(where(is.numeric), sum))) %>% -->
<!--   # Add EPLindex -->
<!--   mutate(EPLI = ((WP*3)+(MP*2)+(PP*1)+(NP*0))/((WP+MP+PP+NP)*3))  -->
<!-- write.csv(epl2024inv_sum, file = "outputs/results_df_EPL_2024_biome_invasives2.csv") #export results  -->
<!-- #summarise EPL 2024 per biome without using any adjustments for invasives (similar to NBA 2018) -->
<!-- epl2024nat_sum <- epl2024 %>% -->
<!--     group_by(T_BIOME,epl_nat24) %>% -->
<!--   summarise(count = n(),.groups = 'drop') %>% -->
<!--   pivot_wider(names_from = epl_nat24,  -->
<!--               values_from = count, values_fill = 0) %>% -->
<!--   relocate(WP, .before = MP)%>% -->
<!--   relocate(NP, .after = PP) %>% -->
<!--    # Add row-wise TOTAL -->
<!--   rowwise() %>% -->
<!--   mutate(Total = sum(c_across(where(is.numeric)))) %>% -->
<!--   ungroup() %>% -->
<!--   # Add TOTAL row (column-wise sums) -->
<!--   bind_rows(summarise(., T_BIOME = "Total", across(where(is.numeric), sum))) %>% -->
<!--   # Add EPLindex -->
<!--   mutate(EPLI = ((WP*3)+(MP*2)+(PP*1)+(NP*0))/((WP+MP+PP+NP)*3))  -->
<!-- write.csv(epl2024nat_sum, file = "outputs/results_df_EPL_2024_biome2_natural.csv") #export results  -->
<!-- ``` -->
<!-- *Calculate biome level summary of EPL 2018 and EPLI 2018* -->
<!-- ```{r} -->
<!-- #summarise EPL2018 per biome with adjustments for invasives  -->
<!-- epl2018inv_sum <- epl2018 %>% -->
<!--     group_by(T_BIOME,epl_nat_inv18) %>% -->
<!--   summarise(count = n(),.groups = 'drop') %>% -->
<!--   pivot_wider(names_from = epl_nat_inv18,  -->
<!--               values_from = count, values_fill = 0) %>% -->
<!--   relocate(WP, .before = MP)%>% -->
<!--   relocate(NP, .after = PP) %>% -->
<!--    # Add row-wise TOTAL -->
<!--   rowwise() %>% -->
<!--   mutate(Total = sum(c_across(where(is.numeric)))) %>% -->
<!--   ungroup() %>% -->
<!--   # Add TOTAL row (column-wise sums) -->
<!--   bind_rows(summarise(., T_BIOME = "Total", across(where(is.numeric), sum))) %>% -->
<!--   # Add EPLindex -->
<!--   mutate(EPLI = ((WP*3)+(MP*2)+(PP*1)+(NP*0))/((WP+MP+PP+NP)*3))  -->
<!-- write.csv(epl2018inv_sum, file = "outputs/results_df_EPL_2018_biome_invasives2.csv") #export results  -->
<!-- #summarise EPL per biome without using any adjustments for invasives (similar to NBA 2018) -->
<!-- epl2018nat_sum <- epl2018 %>% -->
<!--     group_by(T_BIOME,epl_nat18) %>% -->
<!--   summarise(count = n(),.groups = 'drop') %>% -->
<!--   pivot_wider(names_from = epl_nat18,  -->
<!--               values_from = count, values_fill = 0) %>% -->
<!--   relocate(WP, .before = MP)%>% -->
<!--   relocate(NP, .after = PP) %>% -->
<!--    # Add row-wise TOTAL -->
<!--   rowwise() %>% -->
<!--   mutate(Total = sum(c_across(where(is.numeric)))) %>% -->
<!--   ungroup() %>% -->
<!--   # Add TOTAL row (column-wise sums) -->
<!--   bind_rows(summarise(., T_BIOME = "Total", across(where(is.numeric), sum))) %>% -->
<!--   # Add EPLindex -->
<!--   mutate(EPLI = ((WP*3)+(MP*2)+(PP*1)+(NP*0))/((WP+MP+PP+NP)*3))  -->
<!-- write.csv(epl2018nat_sum, file = "outputs/results_df_EPL_2018_biome2_natural.csv") #export results  -->
<!-- ``` -->
<!-- #### **Make graphs for NBA** -->
<!-- ```{r} -->
<!-- # to avoid rerunning spatial analysis load data from file... -->
<!-- #data <- read_csv("C:/Rdata/EPL_terr/outputs/results_df_EPL_2024_biome_invasives2.csv") -->
<!-- #data <- read_csv("C:/Rdata/EPL_terr/outputs/results_df_EPL_2018_biome_invasives2.csv") -->
<!-- # load nbaR package : first run this in console devtools::install_github("SANBI-NBA/nbaR")  -->
<!-- library(nbaR) -->
<!-- # Use NBA package to make EPL graph (need high res output for booklet) -->
<!-- EPL <- epl2024inv_sum %>% -->
<!--     rename(`Well Protected` = WP,  -->
<!--            `Moderately Protected` = MP,  -->
<!--            `Poorly Protected` = PP,  -->
<!--            `Not Protected` = NP ) # %>% -->
<!--   # select(-...1) # required if importing from CSV -->
<!-- epl24_bar_plot <- nba_plot(EPL, -->
<!--                   `T_BIOME`, -->
<!--                   2:5, -->
<!--                  CHRT = "bar", -->
<!--                  NUM = TRUE, -->
<!--                  LAB = "Percentage of ecosystem types", -->
<!--                 SAVE = NULL) -->
<!-- epl24_bar_plot -->
<!-- #export the graph -->
<!-- ggsave( -->
<!--   filename = "outputs/epl24_bar_plot.jpeg", # File name -->
<!--   plot = epl24_bar_plot,                   # Plot object -->
<!--   device = "jpeg",                        # File format -->
<!--   width = 16, height = 12, units = "cm",   # Dimensions -->
<!--   dpi = 300                               # Resolution -->
<!-- ) -->
<!-- #make a line plot of EPL Index using 2018 and 2014 timepoints - request Natasha to impve this or add to package. -->
<!-- biome_colors <- c( -->
<!--   "Albany Thicket" = "darkgreen", -->
<!--   "Azonal" = "blue", -->
<!--   "Desert" =  "darkgrey", -->
<!--   "Forest" =  "darkblue", -->
<!--   "Fynbos"  =  "purple", -->
<!--   "Grassland"  = "green3", -->
<!--   "IOCB"  = "orange", -->
<!--   "Nama-Karoo" = "brown1", -->
<!--   "Savanna"  =  "brown", -->
<!--   "Succulent Karoo"  = "yellow3", -->
<!--   "Total" = "black" -->
<!-- ) -->
<!-- EPLI <- epl2024inv_sum %>% -->
<!--   select(T_BIOME, EPLI) %>%  -->
<!--   rename(EPLI24 = EPLI) %>% -->
<!--    left_join(epl2018inv_sum, by ="T_BIOME") %>% -->
<!--    rename(EPLI18 = EPLI) %>% -->
<!--    rename(Biome = T_BIOME) %>% -->
<!--   select(Biome,EPLI18, EPLI24) %>% -->
<!--   pivot_longer(cols = c(2,3), names_to = "Year", values_to = "EPLI") %>% -->
<!--     mutate(Year = case_when( -->
<!--     Year == "EPLI18" ~ "2018", -->
<!--     Year == "EPLI24" ~ "2024", -->
<!--     TRUE ~ Year -->
<!--   )) -->
<!--   epli_line_plot <- ggplot(EPLI, aes(x = Year, y = EPLI, group = Biome, color = Biome)) + -->
<!--   scale_color_manual(values = biome_colors) +  -->
<!--     geom_line(size = 1.2) + -->
<!--   geom_point(size = 2) + -->
<!--   theme_minimal() + -->
<!--   labs(x = "Year", y = "EPLI") + -->
<!--   scale_x_discrete(limits = c("2018", "2024")) -->
<!--   epli_line_plot -->
<!--   #export the graph -->
<!-- ggsave( -->
<!--   filename = "outputs/epli_line_plot.jpeg", # File name -->
<!--   plot = epli_line_plot,                   # Plot object -->
<!--   device = "jpeg",                        # File format -->
<!--   width = 16, height = 12, units = "cm",   # Dimensions -->
<!--   dpi = 300                               # Resolution -->
<!-- ) -->
<!-- ``` -->
<!-- ## References -->
<!-- ::: {#refs} -->
<!-- ::: -->
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll("figcaption").forEach(e => {
          const text = e.innerHTML.trim();
          // Only proceed if it starts with "Figure" or "Table"
          if (/^(Figure|Table)\b/.test(text)) {
            const match = text.match(/^([^<]*?\.)\s*(.*)$/s); // Match up to first period before any tag
          if (match) {
            const strongPart = `<strong>${match[1]}</strong>`;
            const rest = match[2];
            e.innerHTML = `${strongPart} ${rest}`;
          }
        }
      });
  });
</script>   




</body></html>